# v1_service.yml
---
examples:

  - create:
      name: myservice
      namespace: myproject
      service_spec_selector:
        app: django
      service_spec_ports:
        - port: 8765
          targetPort: 8000
          name: http-port
      service_spec_type: ClusterIP
    name: Create service
    assertions:
      - k8sobj.metadata.name == 'myservice'
      - len(k8sobj.spec.ports) == 1
      - "k8sobj.spec.ports[0].target_port == 8000"
      - k8sobj.spec.selector.get('app') == 'django'
      - k8sobj.spec.type == 'ClusterIP'

  - patch:
      name: myservice
      namespace: myproject
      service_spec_selector:
        app: django
        env: production
      service_spec_ports:
        - port: 8765
          target_port: 8010
          name: http-port
        - port: 8788
          target_port: 8080
          name: socket-port
      service_spec_type: NodePort
    name: Patch service
    assertions:
      - k8sobj.metadata.name == 'myservice'
      - len(k8sobj.spec.ports) == 2
      - "k8sobj.spec.ports[0].target_port == 8010"
      - "k8sobj.spec.ports[1].target_port == 8080"
      - k8sobj.spec.selector.get('app') == 'django'
      - k8sobj.spec.selector.get('env') == 'production'
      - k8sobj.spec.type == 'NodePort'
